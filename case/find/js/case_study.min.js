var ntt_ba_casestudy = {};

$(window).load(function()
{
	ntt_ba_casestudy = ntt_ba_casestudy();
	ntt_ba_casestudy.init();
});

var ntt_ba_casestudy = function()
{
	// 
	var that = {};

	/* 
	 * 
	 */
	var init = function()
	{
		var $service = $('#service');
		var original = $service.html();

		$('#category').change( function () 
		{
			var parent_val = $(this).val();

			$service.html( original ).find( 'option' ).each( function() 
			{
				var child_val = $( this ).data( 'val' );

				if ( parent_val != child_val ) 
				{
					$(this).not('#service_msg').remove();
				}
			});

			if ($(this).val() === '') 
			{
				$service.html( original );
			} 
			else 
			{
				$service.removeAttr('disabled');
			}
		});


		$('#btn_reset').click( function () 
		{
			$('#category option:first').prop( 'selected', true );	
			$('#service').html( original );	
			$('#service option:first').prop( 'selected', true );	
			$('input[type=radio]').prop( 'checked' , false );
			$('input[type=checkbox]').prop( 'checked' , false );
		});

		$('#btn_find').click( function () 
		{
			var selected = $('*:checked').map(function() 
			{
				if( this.id == 'radio1' ){}
				else if( this.id  == 'radio2' ){}
				else if( this.id  == 'radio3' ){}
				else if( this.id  == 'radio4' ){}
				else if( this.id  == 'radio5' ){}
				else
				{
					return $(this).val();
				}
			});

			to_results( selected );
		});
	};	


	var to_results = function( selected )
	{
		var tags =[];

		selected.each( function( key , value )
		{
			tags[ key ] = value;  
		})

		var category = ( tags[ 0 ] != '' ) ? selected[ 0 ] : '' ;
		var service = ( tags[ 1 ] != '' ) ? selected[ 1 ] : '' ;
		tags.shift();
		tags.shift();

		var query = '';
		query += '?c=' + category;
		query += '&s=' + service ;
		query += '&t=' + tags.join( ',' ) ;

		if( $( '#radio1:checked' ).val() )   query += '&e=' + $( '#radio1' ).val();
		if( $( '#radio2:checked' ).val() )   query += '&e=' + $( '#radio2' ).val();
		if( $( '#radio3:checked' ).val() )   query += '&e=' + $( '#radio3' ).val();
		if( $( '#radio4:checked' ).val() )   query += '&e=' + $( '#radio4' ).val();
		if( $( '#radio5:checked' ).val() )   query += '&e=' + $( '#radio5' ).val();

		var send_file = $('#find-page > form').attr('action');

		if( send_file == '' ) send_file = '/case/find/result.html';

		location.href = send_file + query;
	};


	// 
	that.init = init;

	// 
	return that;
};